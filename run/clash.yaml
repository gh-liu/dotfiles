# https://raw.githubusercontent.com/MetaCubeX/mihomo/refs/heads/Alpha/docs/config.yaml
mixed-port: 10801
allow-lan: true
bind-address: "*"
lan-disallowed-ips:
  - 192.168.0.3/32
mode: rule
log-level: info
external-controller: 0.0.0.0:9093
profile:
  store-selected: true
  store-fake-ip: true
geox-url:
  geoip: "https://fastly.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@release/geoip.dat"
  geosite: "https://fastly.jsdelivr.net/gh/MetaCubeX/meta-rules-dat@release/geosite.dat"
dns:
  enable: true
  ipv6: false
  listen: 0.0.0.0:1053
  use-hosts: true
  enhanced-mode: fake-ip
  fake-ip-range: 198.18.0.1/16
  fake-ip-filter:
    - "*.lan"
    - "*.local"
    - "localhost"
  default-nameserver:
    - 223.5.5.5
    - 119.29.29.29
  nameserver:
    - https://223.5.5.5/dns-query
    - https://doh.pub/dns-query
  fallback:
    - https://dns.google/dns-query
    - https://cloudflare-dns.com/dns-query
  fallback-filter:
    geoip: true
    geoip-code: CN
  proxy-server-nameserver:
    - 223.5.5.5
sniffer:
  enable: true
  sniff:
    HTTP:
      ports: [80, 8080-8880]
      override-destination: true
    TLS:
      ports: [443, 8443]
      override-destination: true
    QUIC:
      ports: [443, 8443]
  skip-domain:
    - "*.lan"
    - "*.local"
proxy-providers:
  main_sub:
    type: http
    url: ${CLASH_SUBSCRIPTION_URL}
    interval: 3600
    # path: ./main_sub.yaml
    health-check:
      enable: true
      interval: 600
      url: https://cp.cloudflare.com/generate_204
proxy-groups:
  - name: ğŸ‡­ğŸ‡° HK
    type: url-test
    url: https://cp.cloudflare.com/generate_204
    interval: 86400
    tolerance: 80
    use:
      - main_sub
    filter: "(?i)(æ¸¯|HK|Hong)"
  - name: ğŸ‡¹ğŸ‡¼ TW
    type: url-test
    url: https://cp.cloudflare.com/generate_204
    interval: 86400
    tolerance: 80
    use:
      - main_sub
    filter: "(?i)(å°|TW|Tai)"
  - name: ğŸ‡¯ğŸ‡µ JP
    type: url-test
    url: https://cp.cloudflare.com/generate_204
    interval: 86400
    tolerance: 80
    use:
      - main_sub
    filter: "(?i)(æ—¥æœ¬|JP|Japan)"
  - name: ğŸ‡°ğŸ‡· KR
    type: url-test
    url: https://cp.cloudflare.com/generate_204
    interval: 86400
    tolerance: 80
    use:
      - main_sub
    filter: "(?i)(KR|Korea|éŸ©)"
  - name: ğŸ‡¸ğŸ‡¬ SG
    type: url-test
    url: https://cp.cloudflare.com/generate_204
    interval: 86400
    tolerance: 80
    use:
      - main_sub
    filter: "(?i)(æ–°åŠ å¡|SG|Singapore)"
  - name: ğŸ‡ºğŸ‡¸ US
    type: url-test
    url: https://cp.cloudflare.com/generate_204
    interval: 86400
    tolerance: 80
    use:
      - main_sub
    filter: "(?i)(ç¾å›½|US|United States)"
  - name: ğŸ‡µğŸ‡­ PH
    type: url-test
    url: https://cp.cloudflare.com/generate_204
    interval: 86400
    tolerance: 80
    use:
      - main_sub
    filter: "(?i)(è²å¾‹å®¾|PH|Philippines)"
  - name: Default
    type: select
    proxies:
      - ğŸ‡­ğŸ‡° HK
      - ğŸ‡¹ğŸ‡¼ TW
      - ğŸ‡¯ğŸ‡µ JP
      - ğŸ‡°ğŸ‡· KR
      - ğŸ‡¸ğŸ‡¬ SG
      - ğŸ‡ºğŸ‡¸ US
      - ğŸ‡µğŸ‡­ PH
      - DIRECT
  - name: Apple
    type: select
    proxies:
      - DIRECT
      - Default
      - ğŸ‡­ğŸ‡° HK
      - ğŸ‡¹ğŸ‡¼ TW
      - ğŸ‡¯ğŸ‡µ JP
      - ğŸ‡°ğŸ‡· KR
      - ğŸ‡¸ğŸ‡¬ SG
      - ğŸ‡ºğŸ‡¸ US
      - ğŸ‡µğŸ‡­ PH
  - name: AI
    type: select
    proxies:
      - ğŸ‡ºğŸ‡¸ US
      - ğŸ‡¸ğŸ‡¬ SG
      - ğŸ‡¯ğŸ‡µ JP
      - ğŸ‡­ğŸ‡° HK
      - ğŸ‡¹ğŸ‡¼ TW
      - ğŸ‡°ğŸ‡· KR
      - ğŸ‡µğŸ‡­ PH
      - Default
      - DIRECT
  - name: Streaming
    type: select
    proxies:
      - Default
      - ğŸ‡­ğŸ‡° HK
      - ğŸ‡¹ğŸ‡¼ TW
      - ğŸ‡¯ğŸ‡µ JP
      - ğŸ‡°ğŸ‡· KR
      - ğŸ‡¸ğŸ‡¬ SG
      - ğŸ‡ºğŸ‡¸ US
      - ğŸ‡µğŸ‡­ PH
      - DIRECT
  - name: Telegram
    type: select
    proxies:
      - ğŸ‡¸ğŸ‡¬ SG
      - ğŸ‡­ğŸ‡° HK
      - ğŸ‡ºğŸ‡¸ US
      - ğŸ‡¯ğŸ‡µ JP
      - ğŸ‡¹ğŸ‡¼ TW
      - ğŸ‡°ğŸ‡· KR
      - ğŸ‡µğŸ‡­ PH
      - Default
      - DIRECT
  - name: Final
    type: select
    proxies:
      - Default
      - DIRECT
rule-providers:
  Advertising:
    type: http
    behavior: classical
    url: https://raw.githubusercontent.com/privacy-protection-tools/anti-AD/master/anti-ad-surge.txt
    path: ./ruleset/Advertising.yaml
    interval: 86400
  China:
    type: http
    behavior: classical
    url: https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Loon/China/China.list
    path: ./ruleset/China.yaml
    interval: 86400
  Apple:
    type: http
    behavior: classical
    url: https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Loon/Apple/Apple.list
    path: ./ruleset/Apple.yaml
    interval: 86400
  Netflix:
    type: http
    behavior: classical
    url: https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Loon/Netflix/Netflix.list
    path: ./ruleset/Netflix.yaml
    interval: 86400
  YouTube:
    type: http
    behavior: classical
    url: https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Loon/YouTube/YouTube.list
    path: ./ruleset/YouTube.yaml
    interval: 86400
  OpenAI:
    type: http
    behavior: classical
    url: https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Loon/OpenAI/OpenAI.list
    path: ./ruleset/OpenAI.yaml
    interval: 86400
  Claude:
    type: http
    behavior: classical
    url: https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Loon/Claude/Claude.list
    path: ./ruleset/Claude.yaml
    interval: 86400
  Telegram:
    type: http
    behavior: classical
    url: https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Loon/Telegram/Telegram.list
    path: ./ruleset/Telegram.yaml
    interval: 86400
  Proxy:
    type: http
    behavior: classical
    url: https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Loon/Proxy/Proxy.list
    path: ./ruleset/Proxy.yaml
    interval: 86400
rules:
  # LAN
  - DOMAIN-SUFFIX,local,DIRECT
  - DOMAIN-SUFFIX,lan,DIRECT
  - IP-CIDR,10.0.0.0/8,DIRECT,no-resolve
  - IP-CIDR,172.16.0.0/12,DIRECT,no-resolve
  - IP-CIDR,192.168.0.0/16,DIRECT,no-resolve
  - IP-CIDR,127.0.0.0/8,DIRECT,no-resolve
  # Advertising 1st
  - RULE-SET,Advertising,REJECT
  # Streaming Services
  - RULE-SET,Netflix,Streaming
  - RULE-SET,YouTube,Streaming
  # AI Services
  - RULE-SET,OpenAI,AI
  - RULE-SET,Claude,AI
  - DOMAIN-SUFFIX,cursor.sh,AI
  - DOMAIN-SUFFIX,cursor.com,AI
  - DOMAIN-SUFFIX,cursorapi.com,AI
  - DOMAIN-SUFFIX,cursor-cdn.com,AI
  # Apple
  - RULE-SET,Apple,Apple
  - RULE-SET,Telegram,Telegram
  - RULE-SET,Proxy,Default
  # CN
  - RULE-SET,China,DIRECT
  - GEOIP,CN,DIRECT
  - MATCH,Final
